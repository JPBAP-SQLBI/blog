---
title: ビジュアル計算
date: 2024-12-27 15:00:00
tags:
  - Power BI
  - Power BI Desktop
  - ビジュアル
  - ビジュアル計算
  - Visual Calculation
  - DAX
---

こんにちは、Power BI サポート チームのチャンです。 

これまでビジュアルの値に対して動的な計算を行いたい場合に、 Power BI で複雑なロジックを使用して DAX 関数でメジャーを作成する必要がありました。

この度、新しく「ビジュアル計算」という機能がリリースされました。
この機能を用いると、列、メジャー、その他のビジュアル計算など、ビジュアル内の任意のデータを参照でき、DAX 式の記述プロセスが簡素化されます。
そのため、累計や移動平均などのビジネスで一般的に用いられる計算を簡単かつ直感的に表現することできます。

本ブログでは「ビジュアル計算」の機能について事例を交えてご紹介します。 

<!-- more -->

> [!IMPORTANT]
> 本記事は弊社公式ドキュメントの公開情報を元に構成しておりますが、
> 本記事編集時点と実際の機能に相違がある場合がございます。
> 最新情報につきましては、参考情報として記載しておりますドキュメントをご確認ください。
> <br><br>
> また、本機能は開発段階 (プレビュー) でございますため、今後予告なしに機能が削除されたり、
> 動作変更が発生する可能性がありますことをあらかじめご了承くださいますようお願い申し上げます。

---
## 目次
---
1. [設定方法](#設定方法)
2. [メリット・活用事例](#メリット・活用事例)
3. [考慮事項と制限事項](#考慮事項と制限事項)


---
## 設定方法
---

### ビジュアル計算のプレビューを有効にしておく 

2024 年 9 月以前は、ビジュアル計算を使用するには、[オプションと設定]>[オプション]>[プレビュー機能] で有効にする必要がありました。 [ビジュアル計算]、[OK] の順に選びます。 ビジュアル計算は、Power BI Desktop の再起動後に有効になります。

2024 年 9 月以降は、ビジュアル計算が既定で有効になっているため、この手順は不要になりました。 プレビュー段階にある間は、上記の設定を使用して、必要に応じてビジュアル計算を無効にすることができます。

<div align="center">
<img src="1.png">
</div>

### ビジュアル計算の作成

計算を作成したビジュアルを選択した状態で、[ホーム] > [新しいビジュアル計算] の手順で選択します。
<div align="center">
<img src="2.png">
</div>

追加されたら以下のような画面でビジュアル計算を編集できます。

① 追加されたビジュアル計算のフィールド
② ビジュアル計算用の DAX 式を入力する箇所
③ ビジュアル計算結果のプレビュー

<div align="center">
<img src="3.png">
</div>

---
## メリット・活用事例
---

ビジュアル計算では様々な DAX 関数をご利用いただけます。
利用可否を確認するには、該当 DAX 関数の公開情報にアクセスしてください。
「適用対象」に「ビジュアル計算」に緑のチェックが入っている場合は、ビジュアル計算を利用できます。

<div align="center">
<img src="4.png">
</div>

#### （１）ランキングを元に行番号の作成

このテーブルビジュアルでは、 SalesAmount の合計値の降順、次に同じ値の場合は、UnitPrice のカウントの降順で並べ替えているとします。

その場合のビジュアル計算に対して、行番号を付けたい場合は、以下の DAX 式で簡単に作成できます。

##### DAX 式
```CMD
No. = RANK(DENSE,ORDERBY([SalesAmount Total],DESC,[UnitPrice Count],DESC))
```

##### 実施イメージ

以下の画像のように DAX 式を入力します。

<div align="center">
<img src="5.png">
</div>

##### 書式設定

画面上から計算結果を確認できます。数値計算の場合、既定では小数点が含まれているため、適宜書式設定の [プロパティ] にてデータ型を変更いただくか、書式を変更いただくよう実施してください。

<div align="center">
<img src="6.png">
</div>

##### 実施結果

作成したビジュアル計算「No.」をビジュアルの一番左側に移動させ、以下のようなビジュアルを作成できます。

<div align="center">
<img src="7.png">
</div>

</p>

> **参考情報**
> - [RANK 関数 (DAX) - DAX | Microsoft Learn](https://learn.microsoft.com/ja-jp/dax/rank-function-dax) 

</p>

#### （２）マトリックスの階層ごとの割合

マトリックスビジュアルで、製品・製品サブカテゴリ・カテゴリでの売上を表示させるとき、製品の売上がサブカテゴリ内で占めている割合、サブカテゴリごとの売上が上位カテゴリ内で占めている割合を算出したい場合がございます。

ビジュアル計算を使うことで、簡単に上記の割合の算出を行なうことができます。

##### DAX 式
```CMD
カテゴリでの割合 = DIVIDE([SalesAmount], COLLAPSE([SalesAmount],ROWS ))
```

##### 実施イメージ

以下の画像のように DAX 式を入力します。

<div align="center">
<img src="8.png">
</div>

##### 書式設定

画面上から計算結果を確認できます。割合として計算しているため、適宜書式設定の [プロパティ] にて「パーセンテージ」に書式を変更いただくよう実施してください。

<div align="center">
<img src="9.png">
</div>

##### 実施結果

以下のようなビジュアルを作成できます。

<div align="center">
<img src="10.png">
</div>

> **参考情報**
> - [COLLAPSE 関数 (DAX) - DAX | Microsoft Learn](https://learn.microsoft.com/ja-jp/dax/collapse-function-dax) 


</br>



---
## 考慮事項と制限事項
---
一部の制限事項を列挙させていただきました。すべての制限事項や最新の情報については、公開情報をご確認ください。

- 次の視覚化タイプとビジュアル プロパティはビジュアル計算や非表示フィールドでは機能しません。
  - ツリーマップ
  - スライサー
  - R ビジュアル
  - Python ビジュアル
  - 主要なインフルエンサー
  - 分解ツリー
  - Q & A
  - スマート説明
  - メトリック
  - ページ分割されたレポート
  - Power Apps
  - Power Automate
  - スモール マルチプル
  - 散布図の再生軸
- ビジュアル計算でフィルター処理することはできません。
- データ カテゴリは、ビジュアル計算では設定できません。
- ビジュアル計算では集計を変更することはできません。
- ビジュアル計算の並べ替え順序を変更することはできません。
- 視覚化計算には条件付き書式設定を適用できません。
</br>

> **参考情報**
> - [ビジュアル計算の使用 (プレビュー)](https://learn.microsoft.com/ja-jp/power-bi/transform-model/desktop-visual-calculations-overview) 

</br>

以上、本ブログが少しでも皆様のお役に立てますと幸いでございます。

---

**アンケートご協力のお願い**
Japan CSS Support Power BI Blog では、作成する記事やブログの品質向上を目的に、匿名回答でのアンケートを実施しております。
ユーザー様のご意見・ご要望を参考に今後もお役に立てるブログを目指してまいりますので、ぜひご協力いただけますと幸いでございます。 

※　所要時間は1分程度となります。
[【ご協力のお願い】Microsoft Japan CSS Power BI Blog ご利用に関するアンケート](https://jpbap-sqlbi.github.io/blog/powerbi/pbi_blogsurvey2022/) 
