---
title: 監査ログのAuditDataカラムからデータを抽出する方法
date: 2025-04-30 00:00:00 
tags:
  - Power BI
  - Power BI Desktop
  - AuditLog
  - 監査ログ
  - Extraction
  - 抽出
  - DAX

---


こんにちは、Power BI サポート チームのファムです。 

Power BI のユーザーアクティビティログには、セキュリティ対策や利用状況の把握、コンプライアンス対応に役立つ情報が含まれています。ログを定期的に確認することで、Power BI をより安心して活用することができます。また、ログの取得だけでなく、監査ログのデータはCSVファイルにエクスポートすることができ、そのファイルの中のAuditData カラムには、監査対象のアクティビティの詳細情報が含まれます。このため、 「AuditData カラムの内容を Power BI 上で分析したい」といったご要望をいただくことがあります。

本ブログでは、監査ログファイルの AuditData カラムから必要な情報を抽出する方法の一例をご紹介します。

</br>

> [!IMPORTANT]
> 弊社サポートをご利用いただいている場合、状況に合わせた調査方針を策定するため、記載の内容とご案内が異なる場合がございます。
> ご不明な点がございましたら弊社サポート担当までお気軽にご質問ください。
> また掲載している画像・手順は投稿時点のものとなります。最新の情報とは異なる可能性がございますので予めご了承ください。

</br>

---
## 目次
---
1. [監査ログとは](#1．監査ログとは)
2. [Power QueryのJSON分析機能を使用してAuditDataカラムの値を抽出する方法](#2．Power-QueryのJSON分析機能を使用してAuditDataカラムの値を抽出する方法)
</br>

---

## 1．監査ログとは

監査ログは、システム内で行われたアクティビティを記録したもので、ユーザーの操作、システムの変更、データのアクセス状況などが含まれます。例えば、Power BI レポートの表示に関するアクティビティログを通じて、誰がいつ、どの環境からレポートにアクセスしたかを追跡することができます。これらの監査ログは、Microsoft Purview ポータルから取得することが可能です。監査ログの取得方法は、以下の手順をご参考ください。

1) Microsoft Purview ポータルのリンクにアクセスします。
https://purview.microsoft.com/audit/

2) 表示されている画面を適宜変更し、“**検索**”ボタンを押下してください。

</br>

<div align="center">
<img src="pic1.png">
</div>

**❶日付と時刻の範囲 (UTC)**
過去7日間がデフォルトで選択されています。日付と時間を選んで、その期間内のイベントを表示します。最大180日まで選択可能です。180日を超えるとエラーが表示されます。
ヒント: 最大180日を選ぶ場合は、開始日を現在の時刻に設定してください。開始日が終了日より後になるとエラーが出ます。また、監査を有効にした日より前の日付は選べません。

**❷キーワード検索**
監査ログで検索するキーワードやフレーズを入力します。特殊文字を含む場合は、アスタリスク(*)に置き換えてください。例: test_search_document → test*search*document
ヒント: キーワード検索はインデックス付きコンテンツ内でのみ行われます。監査データコンテンツは検索されません。

**❸管理単位**
ドロップダウンリストから監査対象の管理単位を選びます。複数選択可能です。すべての管理単位を検索する場合は空白のままにします。

**❹アクティビティ - フレンドリ名**
ドロップダウンリストから監査済みアクティビティのフレンドリ名を選びます。ユーザーと管理者のアクティビティはグループに分かれています。特定のアクティビティやグループを選択できます。検索ボックスでフレンドリ名を検索することも可能です。

**❺アクティビティ - 操作名**
検索結果に含める正確な操作名を入力します。複数の操作名はコンマで区切って入力できます。操作名は正確に入力する必要があります。例: SPOIBIsEnabled,SPOIBIsDisabled
ヒント: 操作名が正しくないと結果は返されません。

**❻レコードの種類**
ドロップダウンリストから監査済みアクティビティのレコードの種類を選びます。複数選択可能です。例: MIPLabel, MipAutoLabelExchangeItem

**❼検索名**
検索ジョブのカスタム名を入力します。名前を入力しない場合、自動的に名前が付けられます。

**❽ユーザー**
検索結果に表示するユーザーの名前を選びます。すべてのユーザーを検索する場合は空白のままにします。

**❾ファイル、フォルダー、またはサイト**
指定したキーワードを含むファイルやフォルダーの名前を入力します。URLを使用する場合は、完全なURLパスを入力するか、特殊文字やスペースを含まない部分的なURLを入力してください。

**❿ワークロード**
関連するアクティビティを検索するワークロードサービスを入力または選択します。


> **参考情報**
>  [監査ログの検索](https://learn.microsoft.com/ja-jp/purview/audit-search)


3) 監査ログのファイルをエクスポートします。
検索結果を選択し、「**エクスポート**」ボタンをクリックしてファイルをダウンロードします。

</br>

<div align="center">
<img src="pic2.png">
</div>


4) 監査ログのCSVファイルを開くと以下のイメージをご確認いただけます。
エクスポートした監査ログのCSVファイルは以下のようなイメージです。

</br>

<div align="center">
<img src="pic3.png">
</div>

エクスポートしたファイルはCSV形式ですが、 AuditData カラムはJSON形式となっています。このJSONを整形すると、例えば、どのアイテムのアクティビティログか、アイテムのワークスペース名は何か、どのオペレーションで実施したか、どの環境で利用されていたか、などの情報が入っています。これらの情報を抽出する方法について次の章で説明します。

</br>

<div align="center">
<img src="pic4.png">
</div>

また、Power BIのユーザーアクティビティ追跡方法について、以下のPower BIサポートチームのブログを詳細にまとめておりますので、併せてご確認ください。

> **参考情報**
>  [Power BI のユーザーアクティビティ追跡方法の比較](https://jpbap-sqlbi.github.io/blog/powerbi/pbi_activity_log_usage_metrics/)


## 2．Power QueryのJSON分析機能を使用してAuditDataカラムの値を抽出する方法
AuditData カラムは JSON 形式ですので、Power QueryのJSON分析機能を使って中身を分解します。詳しい手順は以下をご確認ください。

1) Power BI Desktopを起動します。
「**データを取得**」 ＞ 「**テキスト/CSV**」 をクリックし、監査ログのCSVファイルを選択します。

</br>

<div align="center">
<img src="pic7.png">
</div>

2) CSVファイルを読み込み後、以下のデータビューをご確認できます。

</br>

<div align="center">
<img src="pic8.png">
</div>


3) 「**ホーム**」 ＞ 「**データの変換**」をクリックし、Power Query エディターを起動します。

</br>

<div align="center">
<img src="pic1new.png">
</div>



4) 「**AuditData**」カラムを選択し、「**変換**」 ＞ 「**分析**」 ＞ 「**JSON**」を選択します。

</br>

<div align="center">
<img src="pic2new.png">
</div>


5) 「**AuditData**」カラムの拡張アイコンを選択し、「**OK**」をクリックします。

</br>

<div align="center">
<img src="pic3new.png">
</div>


6) 「**AuditData**」カラムを展開後、「**閉じて適用**」をクリックします。

</br>

<div align="center">
<img src="pic4new.png">
</div>


7) レポートビューで、必要な項目をテーブルとして作成します。
たとえば、以下のイメージでは「**アイテム名**」、「**ワークスペース名**」、「**操作名**」、「**ユーザーID**」などの項目が含まれています。
お客様のシナリオに応じて、必要な項目を追加してみてください。

</br>

<div align="center">
<img src="pic5new.png">
</div>


手順は以上となります。

</br>
以上、本ブログ が少しでも皆様のお役に立てますと幸いでございます。


---

**アンケートご協力のお願い**
Japan CSS Support Power BI Blog では、作成する記事やブログの品質向上を目的に、匿名回答でのアンケートを実施しております。
ユーザー様のご意見・ご要望を参考に今後もお役に立てるブログを目指してまいりますので、ぜひご協力いただけますと幸いでございます。 

※　所要時間は1分程度となります。
[【ご協力のお願い】Microsoft Japan CSS Power BI Blog ご利用に関するアンケート](https://jpbap-sqlbi.github.io/blog/powerbi/pbi_blogsurvey2022/)